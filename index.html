<!DOCTYPE html>
<html lang="mk">
<head>
<meta charset="UTF-8">
<title>Рандомко</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: #0b0b0b;
    color: #fff;
  }

  header {
    padding: 1rem;
    background: #111;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .brand {
    font-size: 1.4rem;
    font-weight: bold;
  }

  button {
    background: #222;
    border: none;
    color: #fff;
    padding: 0.4rem 0.7rem;
    cursor: pointer;
    border-radius: 6px;
  }

  section {
    padding: 1rem;
  }

  h2 {
    margin-bottom: 0.5rem;
  }

  .movies {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 1rem;
  }

  .movie {
    cursor: pointer;
    transition: transform 0.2s;
  }

  .movie:hover { transform: scale(1.05); }

  img {
    width: 100%;
    border-radius: 10px;
  }

  .title {
    font-size: 0.9rem;
    margin-top: 0.3rem;
  }

  .rating {
    color: #f5c518;
    font-size: 0.8rem;
  }

  .genre-label {
    font-size: 0.75rem;
    opacity: 0.7;
  }

  .modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }

  .modal-content {
    background: #111;
    max-width: 600px;
    width: 100%;
    padding: 1rem;
    border-radius: 12px;
  }

  .close {
    text-align: right;
    cursor: pointer;
    font-size: 1.2rem;
  }
</style>
</head>

<body>

<header>
  <div class="brand" id="brand"></div>
  <button onclick="toggleLang()">MK / EN</button>
</header>

<section>
  <h2 id="randomTitle"></h2>
  <div class="movies" id="random-genres"></div>
</section>

<section>
  <h2 id="popularTitle"></h2>
  <div class="movies" id="popular"></div>
</section>

<section>
  <h2 id="upcomingTitle"></h2>
  <div class="movies" id="upcoming"></div>
</section>

<div class="modal" id="modal">
  <div class="modal-content">
    <div class="close" onclick="closeModal()">✖</div>
    <h2 id="modalTitle"></h2>
    <p id="modalOverview"></p>
  </div>
</div>

<script>
  const IMG = "https://image.tmdb.org/t/p/w500";
  const TMDB_TOKEN = "__TMDB_TOKEN__";

  const headers = {
    accept: "application/json",
    Authorization: `Bearer ${TMDB_TOKEN}`
  };

  let lang = "mk";

  const i18n = {
    mk: {
      brand: "Рандомко – филмски хаос со ред",
      random: "Рандом филм за секоа можна категорија",
      popular: "Моментално популарни филмови",
      upcoming: "Филмови шо треба да излезат или се пресно испаднати",
      noDesc: "Нема опис, Рандомко одмара"
    },
    en: {
      brand: "Randomko – movie chaos done right",
      random: "Random movie from every genre",
      popular: "Popular movies right now",
      upcoming: "Upcoming & freshly released movies",
      noDesc: "No description available."
    }
  };

  function applyLang() {
    document.documentElement.lang = lang;
    brand.textContent = i18n[lang].brand;
    randomTitle.textContent = i18n[lang].random;
    popularTitle.textContent = i18n[lang].popular;
    upcomingTitle.textContent = i18n[lang].upcoming;
  }

  function toggleLang() {
    lang = lang === "mk" ? "en" : "mk";
    applyLang();
  }

  const modal = document.getElementById("modal");
  const modalTitle = document.getElementById("modalTitle");
  const modalOverview = document.getElementById("modalOverview");

  function fetchJSON(url) {
    return fetch(url, { headers }).then(r => r.json());
  }

  function renderMovie(el, movie, label = "") {
    el.innerHTML = `
      <img loading="lazy" src="${IMG + movie.poster_path}">
      <div class="title">${movie.title}</div>
      <div class="rating">⭐ ${movie.vote_average}</div>
      ${label ? `<div class="genre-label">${label}</div>` : ""}
    `;
    el.onclick = () => openModal(movie);
  }

  function openModal(movie) {
    modalTitle.textContent = movie.title;
    modalOverview.textContent = movie.overview || i18n[lang].noDesc;
    modal.style.display = "flex";
  }

  function closeModal() {
    modal.style.display = "none";
  }

  function renderList(id, movies, limit = 12) {
    const c = document.getElementById(id);
    movies.slice(0, limit).forEach(m => {
      const el = document.createElement("div");
      el.className = "movie";
      renderMovie(el, m);
      c.appendChild(el);
    });
  }

  applyLang();

  fetchJSON("https://api.themoviedb.org/3/movie/popular")
    .then(d => renderList("popular", d.results));

  fetchJSON("https://api.themoviedb.org/3/movie/upcoming")
    .then(d => renderList("upcoming", d.results));

  fetchJSON("https://api.themoviedb.org/3/genre/movie/list")
    .then(d => {
      const c = document.getElementById("random-genres");
      d.genres.forEach(g => {
        fetchJSON(
          `https://api.themoviedb.org/3/discover/movie?with_genres=${g.id}&sort_by=popularity.desc`
        ).then(r => {
          if (!r.results.length) return;
          const m = r.results[Math.floor(Math.random() * r.results.length)];
          const el = document.createElement("div");
          el.className = "movie";
          renderMovie(el, m, g.name);
          c.appendChild(el);
        });
      });
    });
</script>

</body>
</html>
